{
    "contents" : "#\nlibrary(rvest)\nsource(\"sina_data_url.R\")\n#============================复权数据==================================\ngetPeriodRestorationofRightPrice = function(startDate, endDate, stockid){\n  startDate = as.Date(startDate)\n  endDate = as.Date(endDate)\n  #判断startDate和endDate， 大小关系，是否在不同的季度\n  if(startDate >= endDate)\n    return (\"开始时间必须小于结束时间\")\n  yq1 = format(as.yearqtr(startDate), format = \"year=%Y&jidu=%q\")\n  yq2 = format(as.yearqtr(endDate), format = \"year=%Y&jidu=%q\")\n  \n  if(yq1!=yq2){\n    data = getRestorationofRightPrice(yq1, stockid)\n    data = rbind(data,getRestorationofRightPrice(yq2, stockid))\n  }else\n    data = getRestorationofRightPrice(yq1, stockid)\n    \n  #截取大于范围内的\n  index = rownames(data)\n  data = data[startDate <= index  & endDate >= index,]\n  return (xts(data, order.by = as.Date(rownames(data))))\n}\n#处理获取指定年份和季度的复权数据\ngetRestorationofRightPrice = function(request_parameter, stockid){\n  #获取时间中的年份和季度信息\n  #request_parameter = format(as.yearqtr(date), format = \"year=%Y&jidu=%q\")\n  url = paste(RestorationofRight_url,stockid,\".phtml?\",request_parameter,sep = \"\")\n  webpage = read_html(url)#请求网页\n  #解析网页中的历史复权数据\n  data_table = (webpage %>% html_node(\"table#FundHoldSharesTable\") %>% html_table())\n  colnames(data_table) = data_table[1,]#数据的第一行为表头\n  data_table = data_table[-1,]#去掉第一行\n  rownames(data_table) = data_table[,1]#将时间信息转成行索引\n  data_table = data_table[,-1]#去掉第一列\n  for(i in 1:ncol(data_table)){\n    #将数字字符串转成数字\n    data_table[,i] = as.numeric(data_table[,i])\n  }\n  return (data_table)\n}\n\n\n#============================板块股票数据==================================\ngetIndustralCategoryStocks = function(url){\n  #获取数据的json主体\n  temp = fromJSON(str_extract_all(read_html(url), \"\\\\[.+\\\\]\")[[1]][2], \n                  simplifyDataFrame = data.frame)[[1]]\n  \n  colnames(temp$items) = temp$fields\n  return (temp)\n}\n\n#\n\n\n",
    "created" : 1450444036890.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "7923651",
    "id" : "EEFCB5ED",
    "lastKnownWriteTime" : 1450615059,
    "path" : "~/Documents/R_workspace/stock_web/sina_financial.R",
    "project_path" : "sina_financial.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}